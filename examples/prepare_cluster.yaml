name: cluster_is_prepared
spec:
  requirements:
    - has_openshift  # could be omitted (implicit, already in has_nfd_num_label dependencies)
    - has_nfd_num_label
---
name: has_openshift
spec:
  tests:
    - shell:
        cmd: oc version
  # cannot be installed, no need for 'install' block
---
name: can_query_nodes
spec:
  requirements:
    has_openshift
  tests:
    - name: can_query_nodes # optional
      type: shell # vvv 'short' shell spec
      spec: "oc get nodes"
---
name: has_nfd
spec:
  requirements:
    - has_openshift
    - can_query_nodes
  tests: # main logic: or (=prefer plugin)
    - name: has_nfd_plugin
      type: plugin
      spec:
        name: nfd_plugin
        param: node_has_label(node.has.nfd)

    - name: has_nfd_shell
      type: shell
      spec: # vvv full 'shell' spec
        cmd: oc get nodes -lnode.has.nfd -oname
        rc: 0 # (default)

  install:
  - name: install_nfd # optional
    type: shell
    spec: "oc label name node.has.nfd=true"
---
name: has_nfd_num_label
spec:
  requirements:
    - has_nfd
  tests:
    - type: shell
      cmd: oc get nodes -lnode.has.nfd.1 -oname
  install:
    - type: shell
      cmd: oc label nodes -lnode.has.nfd node.has.nfd.1=true